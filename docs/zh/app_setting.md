# 应用设置

设置页主要包含了以下几个部分：

## Chaldea User
一个简易的用户系统，仅用于备份数据至服务器并实现多设备同步数据。没有此需求可以不用创建账号，不影响其他一切应用内的功能。
::: warning
没有安全保证，请勿使用常用密码
:::

## 游戏账号设置
* 多个账号切换
* 所属服务器：目前关联的设置有素材交换券的月份设置和默认活动/卡池进度
  * 日服
  * 国服: Mooncell上的国服时间或与日服相差15个月
  * 台服: 与日服相差21个月
  * 美服: 与日服相差24个月
* 活动进度: 设置活动、卡池列表中隐藏过期活动，可默认使用各服务器时间（同上）或自定义某个活动
> 一般的，认为子活动开始一个月以上的作为过期活动隐藏；素材交换券由于可存3个月，故过期4个月隐藏。

## 应用数据
> 数据根目录(`root_path`): 本应用所有数据保存的根目录，可用于手动备份还原。

::: warning
对于Android和iOS，卸载应用将彻底删除`root_path`，导致所有数据丢失，请注意备份。
:::

不同操作系统根目录不同
| OS       | 根目录                                   |
| :------- | :-------------------------------------- |
| iOS      | `文件应用/我的iPhone/Chaldea/`            |
| Android  | `{emulated or SD card}/Android/data/cc.narumi.chaldea/files/` |
| Windows  | `chaldea.exe所在目录/userdata`            |
| macOS    | `/Users/<user>/Library/Containers/cc.narumi.chaldea/Data/Documents/` |
> 实际路径可在`用户数据-数据目录`中查看

::: warning
Android: 若存在SD卡，用户可选择是否启用外部储存(SD卡)，请注意区分内部储存和外部储存的路径，可以在用户数据中设置。
:::

文件目录结构
```:no-line-numbers
root_path
├── backup  // 每日备份userdata.json于此
├── config  // 部分本地数据、缓存
├── data    // 应用数据包dataset*.zip解压路径
│   ├── dataset.json
│   └── icons
├── downloads
├── ffo     // Fate/Freedom Order数据包解压路径
├── ffo_output
├── logs
├── temp
└── user
    └── userdata.json   // 用户相关所有数据，备份这个最重要
```

### 用户数据管理
提供备份与还原(导入)的功能，同时每天启动时会自动创建一个备份，可从历史备份中选择恢复。

服务器提供了简易的备份功能，可实现多设备的同步，需要手动上传下载，暂时无法自动同步。

**安卓外部储存**

安卓用户可选择是否开启外部储存(若存在SD卡)，更改设置时，可选择自动迁移源数据至目标文件夹。
注意若目标文件已存在，自动迁移将覆盖数据！若不自动迁移，建议手动迁移数据后重启应用。

> 做好手动备份以防意外！主要用户数据为`userdata`、`config`和`backup`文件夹。

需要重启应用使该设置生效。

### 游戏数据管理
数据版本即为日期，为当日于各网站提取的数据。完整的数据版本包含了兼容的最小应用版本：
如20210922-1.6.0表示最低要求APP版本>=1.6.0才可使用，否则旧版应用无法导入新版数据。

* 下载源
  * Server: 通过服务器代理获取应用更新和数据包更新，仅推荐国内无法连接Github时使用
  * Github: 若可直连，推荐使用
  * Gitee: 由于限制多且经常下载失败故已屏蔽，但仍可打开网页手动下载
* 数据包更新方式
  * 自动更新: 启动时自动更新，优先从服务器获取补丁，若更新失败，将下载完整数据。
  * 补丁式更新: 比较节省流量
  * 下载最新数据: 从相应数据源下载完整的`dataset-text.zip`
  * 下载图标: 缓存所有图标至`app_path/data/icons/`，大约3000+图标，因此下载时进行了速度限制每秒最多5次下载请求。
  * 导入dataset.zip: 自行从相应github/gitee页面下载`dataset-text.zip`后导入，注意数据版本与应用版本的兼容性。
  * 重新载入预装版本: 安装包内置版本
* 缓存资源：
  * 图标类: 卡牌缩略图、技能图标等，下载后持久性储存，储存于`app_path/data/icons/`
  * 立绘、语音：清除缓存后需重新下载缓存，仅使用时下载

### 通用设置
* 多语言支持：中、英、日(部分支持)
* 深色模式/夜间模式
* 置顶显示: 仅桌面端可用
* 自动旋转: 仅移动端（iPad除外），是否允许横屏
* 首页显示当前账号名称
* 轮播设置：首页轮播图，以下几个数据源
  * App通知：通常为有严重bug时来催赶紧更新，常开，除非关闭整个轮播图显示
  * Mooncell首页轮播图
  * 日服公告栏轮播图
  * 美服公告栏轮播图

### 显示设置
* 筛选自动重置：主要用于从者/礼装/纹章列表页筛选选项在每次进入时自动重置
* 从者列表页
  * **关注**按钮默认选项：
  关注按钮有三种状态（关注/未关注/所有），可设置每次进入时时重设为所有、已关注或记住上一次选择
  * 顶部职阶筛选样式
    - 自动匹配
    - 单行不展开Extra职阶
    - 单行并展开Extra职阶
    - 两行显示，Extra职阶显示在第二行
    - 隐藏职阶筛选（仍可在弹出的筛选设置里设置）
  * [规划列表页]统一设置附加技能: 仅技能2 或 全部三个技能
* 从者详情页
  * 标签页排序：规划、技能、宝具等等标签页自定义排序，
  * 优先级备注：从者优先级有1-5，该备注项主要用于标记每个优先级的含义，显示在图标下方

## APP自动更新
在`关于Chaldea`中可开启自动更新，下载源与上述数据包下载源相同。
- 自动更新适用于Android、Windows。
  - Windows版程序所在路径有中文等字符可能会导致自动更新失败。
- 非商店版的macOS版会检测并下载新版，需自行解压替换。
- iOS和macOS商店版请前往App Store更新。